{"version":3,"sources":["webpack:///./src/views/rules/student/Chat.vue?a51f","webpack:///./src/views/rules/student/Chat.vue?d741","webpack:///src/views/rules/student/Chat.vue","webpack:///./src/views/rules/student/Chat.vue?be3e","webpack:///./src/views/rules/student/Chat.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","class","classes","staticStyle","_v","_s","school","manager","name","_l","message","key","id","from","profile","content","attrs","sending","nativeOn","$event","type","indexOf","_k","keyCode","sendMessage","model","value","callback","$$v","$set","expression","staticRenderFns","data","to","manager_id","messages","methods","fetchSchool","offset","err","fetchMessages","scrollToBottom","$nextTick","container","scrollTo","top","scrollHeight","behavior","computed","mounted","window","Echo","private","component"],"mappings":"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","file":"js/chunk-a47b01d6.3ea34dde.js","sourcesContent":["import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--8-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Chat.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--8-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Chat.vue?vue&type=style&index=0&lang=scss&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"main-content\"},[_c('div',{staticClass:\"panel\"},[_c('div',{staticClass:\"panel-body\",class:_vm.classes,staticStyle:{\"height\":\"80vh\",\"display\":\"flex\",\"flex-direction\":\"row\"}},[_c('el-main',{staticStyle:{\"padding\":\"0\"}},[_c('el-container',{staticClass:\"is-vertical\",staticStyle:{\"height\":\"100%\"}},[_c('div',{staticClass:\"chat-header\"},[_c('h1',[_vm._v(_vm._s(_vm.school.manager.name))])]),_c('el-main',{staticStyle:{\"flex\":\"1\",\"flex-basis\":\"auto\",\"overflow\":\"hidden\",\"box-sizing\":\"border-box\",\"display\":\"block\",\"margin\":\"0 20px\",\"padding\":\"0\"}},[_c('div',{staticClass:\"messages-container\"},_vm._l((_vm.messages),function(message){return _c('div',{key:message.id},[_c('div',{class:message.from === _vm.profile.id ? 'im-message-text right' : 'im-message-text left'},[_c('pre',[_vm._v(_vm._s(message.content))])])])}),0)]),_c('el-footer',{staticStyle:{\"margin-top\":\"20px\"}},[_c('el-row',[_c('el-col',[_c('el-input',{attrs:{\"placeholder\":\"Press Enter to send\",\"disabled\":_vm.sending},nativeOn:{\"keyup\":function($event){if(!$event.type.indexOf('key')&&_vm._k($event.keyCode,\"enter\",13,$event.key,\"Enter\")){ return null; }return _vm.sendMessage($event)}},model:{value:(_vm.message.content),callback:function ($$v) {_vm.$set(_vm.message, \"content\", $$v)},expression:\"message.content\"}})],1)],1)],1)],1)],1)],1)])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"main-content\">\n    <div class=\"panel\">\n      <div class=\"panel-body\" :class=\"classes\" style=\"height: 80vh; display: flex; flex-direction: row\">\n        <el-main style=\"padding: 0\">\n          <el-container class=\"is-vertical\" style=\"height: 100%\">\n            <div class=\"chat-header\">\n              <h1>{{school.manager.name}}</h1>\n            </div>\n            <el-main style=\"flex: 1; flex-basis: auto; overflow: hidden; box-sizing: border-box; display: block; margin: 0 20px; padding: 0\">\n              <div class=\"messages-container\">\n                <div v-for=\"message in messages\" :key=\"message.id\">\n                  <div :class=\"message.from === profile.id ? 'im-message-text right' : 'im-message-text left'\">\n                    <pre>{{ message.content }}</pre>\n                  </div>\n                </div>\n              </div>\n            </el-main>\n            <el-footer style=\"margin-top: 20px\">\n              <el-row>\n                <el-col>\n                  <el-input placeholder=\"Press Enter to send\" :disabled=\"sending\" v-model=\"message.content\" @keyup.enter.native=\"sendMessage\"></el-input>\n                </el-col>\n              </el-row>\n            </el-footer>\n          </el-container>\n        </el-main>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport {mapState} from 'vuex'\nimport api from '../../../apis'\n\nexport default {\n  name: 'Chat',\n  data() {\n    return {\n      classes: ['animated', 'fade-in', 'fast'],\n      sending: false,\n      message: {\n        to: '',\n        content: ''\n      },\n      school: {\n        id: '',\n        name: '',\n        manager: {\n          id: '',\n          name: ''\n        },\n        manager_id: ''\n      },\n      messages: []\n    }\n  },\n  methods: {\n    fetchSchool() {\n      api.school.fetchSchool(this.profile.school_id).then(res => {\n        this.school = res.data;\n        this.message.to = this.school.manager_id;\n        this.fetchMessages();\n      }).catch(err => {\n        this.$message.error({\n          offset: 95,\n          message: err.message\n        });\n      });\n    },\n    fetchMessages() {\n      api.message.fetchMessages({to: this.school.manager_id}).then(res => {\n        this.messages = res.data;\n        this.scrollToBottom();\n      }).catch(err => {\n        this.$message.error({\n          offset: 95,\n          message: err.message\n        });\n      });\n    },\n    sendMessage() {\n      this.sending = true;\n      api.message.sendMessage(this.message).then(res => {\n        this.sending = false;\n        this.message.content = '';\n        this.messages.push(res.data);\n        this.scrollToBottom();\n      }).catch(err => {\n        this.sending = false;\n        this.$message.error({\n          offset: 95,\n          message: err.message\n        });\n      })\n    },\n    scrollToBottom() {\n      this.$nextTick(() => {\n        let container = this.$el.querySelector('.messages-container');\n        container.scrollTo({\n          top: container.scrollHeight,\n          behavior: 'smooth'\n        })\n      });\n    }\n  },\n  computed: {\n    ...mapState({\n      profile: state => state.account.profile,\n      access_token: state => state.account.access_token\n    })\n  },\n  mounted() {\n    window.Echo.private(`message.${this.profile.id}`)\n        .listen('.MessageNotification', (e) => {\n          this.messages.push(e.message)\n          this.scrollToBottom();\n        });\n\n    this.fetchSchool();\n  }\n}\n</script>\n\n<style lang=\"scss\">\n.chat-header {\n  padding: 20px;\n  border-bottom-style: inset;\n}\n\n.messages-container {\n  height: 100%;\n  overflow-y: auto;\n  overflow-x: hidden;\n\n  .im-message-text {\n    clear: both;\n    max-width: 70%;\n    min-width: 30px;\n    min-height: 30px;\n    padding: 3px;\n    margin: 10px 0;\n    background: #daf3fd;\n\n    pre {\n      font-size: 14px;\n      overflow: hidden;\n      word-break: break-word;\n      white-space: pre-wrap;\n      padding: 3px 10px;\n    }\n  }\n\n  .right {\n    float: right;\n    border-radius: 10px 0 10px 10px;\n  }\n\n  .left {\n    float: left;\n    background: #e7e7e7;\n    border-radius: 0 10px 10px 10px;\n  }\n}\n</style>","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Chat.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Chat.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Chat.vue?vue&type=template&id=cdb646fc&\"\nimport script from \"./Chat.vue?vue&type=script&lang=js&\"\nexport * from \"./Chat.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Chat.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}